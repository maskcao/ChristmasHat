<!DOCTYPE html>
<!--
åç§°ï¼šç»™ä½ çš„å¤´åƒåŠ ä¸Šåœ£è¯å¸½
åˆ¶ä½œï¼šè•Šè•Š
ç¾å·¥ï¼šè•Šè•Š
Q Q ï¼š1612704618
-->
<html lang='zh-CN'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0'>
  <meta http-equiv='X-UA-Compatible' content='ie=edge'>
  <title>ç»™ä½ çš„å¤´åƒåŠ ä¸Šåœ£è¯å¸½</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Microsoft YaHei", sans-serif;
    }
    body {
      font-size: 16px;
      background-color: #1a1a1a;
      padding: 20px;
      color: #fff;
    }
    .container {
      max-width: 500px;
      margin: 0 auto;
    }
    .page-title {
      font-size: 24px;
      text-align: center;
      margin-bottom: 30px;
      color: #ff9900;
      text-shadow: 0 0 8px rgba(255,153,0,0.6);
    }
    .section {
      background-color: #2d2d2d;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .section-title {
      font-size: 18px;
      margin-bottom: 15px;
      color: #ffcc66;
      display: flex;
      align-items: center;
    }
    .section-title::before {
      content: "ğŸ„";
      margin-right: 8px;
    }
    /* ä¸Šä¼ åŒºåŸŸ */
    .upload-area {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      padding: 20px 0;
    }
    .upload-btn {
      background-color: #3d3d3d;
      border: 1px dashed #666;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .upload-btn:hover {
      border-color: #ff9900;
      background-color: #444;
    }
    #upload {
      display: none;
    }
    .select-img-btn {
      background-color: #ff9900;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      color: #1a1a1a;
      font-weight: 600;
    }
    .select-img-btn:hover {
      background-color: #ffcc66;
      transform: translateY(-2px);
    }
    /* åœ£è¯å¸½é€‰æ‹©æ  */
    .hat-list {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding: 10px 0;
      scrollbar-width: thin;
      scrollbar-color: #ff9900 #3d3d3d;
    }
    .hat-list::-webkit-scrollbar {
      height: 6px;
    }
    .hat-list::-webkit-scrollbar-thumb {
      background-color: #ff9900;
      border-radius: 3px;
    }
    .hat-item {
      width: 85px;
      height: 85px;
      border: 2px solid #444;
      border-radius: 8px;
      padding: 8px;
      cursor: pointer;
      transition: all 0.2s;
      background-color: #333;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .hat-item.active {
      border-color: #ff9900;
      box-shadow: 0 0 10px rgba(255,153,0,0.5);
    }
    .hat-item:hover {
      border-color: #ffcc66;
      transform: scale(1.05);
    }
    .hat-item img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    /* ç”»å¸ƒåŒºåŸŸ */
    .canvas-wrap {
      margin: 20px 0;
      display: none;
      text-align: center;
    }
    #cvs {
      max-width: 100%;
      border: 1px solid #444;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }
    /* å¯¼å‡ºåŒºåŸŸ */
    #export {
      display: none;
      max-width: 300px;
      margin: 20px auto;
      border: 1px solid #444;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }
    /* æ“ä½œæŒ‰é’®åŒºåŸŸ */
    .btn-group {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 10px;
    }
    .btn {
      padding: 12px 28px;
      border-radius: 25px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      border: none;
      font-weight: 600;
    }
    .change-btn {
      background-color: #3d3d3d;
      color: #ffcc66;
    }
    .change-btn:hover {
      background-color: #444;
      transform: translateY(-2px);
    }
    .export-btn {
      background-color: #ff9900;
      color: #1a1a1a;
    }
    .export-btn:hover {
      background-color: #ffcc66;
      transform: translateY(-2px);
    }
    .btn:disabled {
      background-color: #666;
      cursor: not-allowed;
      transform: none;
    }
    /* æç¤ºæ–‡å­— */
    #tip {
      margin-top: 12px;
      font-size: 14px;
      color: #999;
      opacity: 0.8;
    }
    /* åº•éƒ¨æç¤º */
    .footer-tip {
      font-size: 14px;
      color: #888;
      margin-top: 30px;
      text-align: center;
      line-height: 1.8;
    }
    .footer-link {
      color: #ff9900;
      text-decoration: none;
      transition: color 0.3s;
    }
    .footer-link:hover {
      color: #ffcc66;
      text-decoration: underline;
    }
    /* å›¾ç‰‡åŠ è½½å¤±è´¥æç¤º */
    .hat-loading {
      font-size: 12px;
      color: #999;
    }
    /* å“åº”å¼è°ƒæ•´ */
    @media (max-width: 375px) {
      .upload-area {
        flex-direction: column;
        gap: 10px;
      }
      .btn-group {
        flex-direction: column;
      }
      .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="page-title">ç»™ä½ çš„å¤´åƒåŠ ä¸Šåœ£è¯å¸½</h1>

    <!-- é€‰æ‹©å›¾ç‰‡åŒºåŸŸ -->
    <div class="section">
      <h3 class="section-title">é€‰æ‹©è¦åˆ¶ä½œçš„å›¾ç‰‡</h3>
      <div class="upload-area">
        <label for="upload" class="upload-btn">ç‚¹å‡»ä¸Šä¼ å¤´åƒ</label>
        <input id="upload" type="file" onchange="viewer()" accept="image/*">
        <button class="select-img-btn" id="selectImgBtn">é€‰æ‹©å›¾ç‰‡</button>
      </div>
    </div>

    <!-- åœ£è¯å¸½é€‰æ‹©åŒºåŸŸ -->
    <div class="section">
      <h3 class="section-title">é€‰æ‹©ä¸€é¡¶åœ£è¯å¸½ï¼ˆå·¦å³æ»‘åŠ¨ï¼‰</h3>
      <div class="hat-list" id="hatList">
        <!-- å¸½å­é€‰é¡¹ä¼šé€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>

    <!-- ç”»å¸ƒåŒºåŸŸ -->
    <div class="canvas-wrap" id="canvasWrap">
      <canvas id="cvs"></canvas>
      <p id="tip">ç‚¹å‡»å¸½å­è°ƒæ•´ä½ç½®å’Œå¤§å° ğŸ…</p>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="section">
      <h3 class="section-title">åˆ¶ä½œå®Œæˆäº†å°±ä¸‹è½½å§</h3>
      <div class="btn-group">
        <button class="btn change-btn" id="changeBtn" style="display:none;">æ¢ ä¸€ é¡¶</button>
        <button class="btn export-btn" id="exportBtn" style="display:none;" onclick="exportFunc()">ä¿å­˜å›¾ç‰‡</button>
      </div>
    </div>

    <!-- å¯¼å‡ºå›¾ç‰‡å±•ç¤º -->
    <img id="export" alt="åœ£è¯å¤´åƒ" src="" />

    <!-- åº•éƒ¨æç¤º -->
    <div class="footer-tip">
      æœ¬ç«™è‡ª2025å¹´12æœˆ7æ—¥å‚æ™šå¼€å§‹æµé‡æš´æ¶¨ï¼Œåšä¸»å·²ç»å¯¹æœåŠ¡å™¨è¿›è¡Œäº†ä¸€æ¬¡ç´§æ€¥æ‰©å®¹ï¼Œ<br>
      å¦‚æœä½ æ„Ÿåˆ°è®¿é—®é€Ÿåº¦ç¼“æ…¢ï¼Œæ•¬è¯·è°…è§£~<br>
      <a href="http://wpa.qq.com/msgrd?v=3&uin=1612704618&site=qq&menu=yes" target="_blank" class="footer-link">ç‚¹å‡»è¿™é‡Œè”ç³»æˆ‘</a> | 
      <a href="http://wpa.qq.com/msgrd?v=3&uin=1612704618&site=qq&menu=yes" target="_blank" class="footer-link">è®¿é—®æˆ‘çš„åšå®¢</a>
    </div>
  </div>

  <!-- éšè—çš„å›¾ç‰‡èµ„æºï¼ˆè·¯å¾„æ”¹ä¸º hats_images ç›®å½•ï¼Œæ·»åŠ åŠ è½½å¤±è´¥å¤„ç†ï¼‰ -->
  <div style="display: none;">
    <img id="avatarImg" src="" alt="ç”¨æˆ·å¤´åƒ" />
    <!-- åœ£è¯å¸½èµ„æºï¼ˆè·¯å¾„ç»Ÿä¸€æ”¹ä¸º hats_images ç›®å½•ï¼Œæ”¯æŒè‡ªå®šä¹‰æ•°é‡ï¼‰ -->
    <img class="hat-res" src="hats_images/0.png" alt="åœ£è¯å¸½1" data-hat-index="0" />
    <img class="hat-res" src="hats_images/1.png" alt="åœ£è¯å¸½2" data-hat-index="1" />
    <img class="hat-res" src="hats_images/2.png" alt="åœ£è¯å¸½3" data-hat-index="2" />
    <img class="hat-res" src="hats_images/3.png" alt="åœ£è¯å¸½4" data-hat-index="3" />
    <img class="hat-res" src="hats_images/4.png" alt="åœ£è¯å¸½5" data-hat-index="4" />
    <img class="hat-res" src="hats_images/5.png" alt="åœ£è¯å¸½6" data-hat-index="5" />
    <img class="hat-res" src="hats_images/6.png" alt="åœ£è¯å¸½7" data-hat-index="6" />
    <img class="hat-res" src="hats_images/7.png" alt="åœ£è¯å¸½8" data-hat-index="7" />
    <img class="hat-res" src="hats_images/8.png" alt="åœ£è¯å¸½9" data-hat-index="8" />
    <img class="hat-res" src="hats_images/9.png" alt="åœ£è¯å¸½10" data-hat-index="9" />
  </div>

<script src="fabric.min.js"></script>
<script>
  // åˆå§‹åŒ–å˜é‡
  const cvs = document.getElementById("cvs");
  const exportImage = document.getElementById("export");
  const avatarImg = document.getElementById("avatarImg");
  const hatListEl = document.getElementById("hatList");
  const canvasWrap = document.getElementById("canvasWrap");
  const changeBtn = document.getElementById("changeBtn");
  const exportBtn = document.getElementById("exportBtn");
  const selectImgBtn = document.getElementById("selectImgBtn");
  
  let canvasFabric;
  let hatInstance;
  let currentHatIndex = 0;
  let validHatList = []; // å­˜å‚¨åŠ è½½æˆåŠŸçš„å¸½å­
  const hatResList = document.getElementsByClassName("hat-res");
  const screenWidth = Math.min(window.screen.width - 40, 350); // ç”»å¸ƒå®½åº¦ï¼ˆå‡å»è¾¹è·ï¼‰

  // é¢„åŠ è½½æ‰€æœ‰å¸½å­å›¾ç‰‡ï¼Œè¿‡æ»¤åŠ è½½å¤±è´¥çš„
  function preloadHats() {
    return new Promise((resolve) => {
      let loadedCount = 0;
      const total = hatResList.length;

      // éå†æ‰€æœ‰å¸½å­èµ„æº
      Array.from(hatResList).forEach((hat, index) => {
        // ç›‘å¬åŠ è½½æˆåŠŸ
        hat.onload = () => {
          validHatList.push({
            src: hat.src,
            index: index
          });
          loadedCount++;
          checkAllLoaded();
        };

        // ç›‘å¬åŠ è½½å¤±è´¥
        hat.onerror = () => {
          console.warn(`å¸½å­å›¾ç‰‡åŠ è½½å¤±è´¥ï¼š${hat.src}`);
          loadedCount++;
          checkAllLoaded();
        };

        // æ‰‹åŠ¨è§¦å‘åŠ è½½ï¼ˆå¦‚æœè¿˜æ²¡åŠ è½½ï¼‰
        if (hat.complete) {
          hat.onload();
        }
      });

      // æ‰€æœ‰å›¾ç‰‡éƒ½å¤„ç†å®Œå resolve
      function checkAllLoaded() {
        if (loadedCount === total) {
          resolve();
        }
      }
    });
  }

  // ç”Ÿæˆåœ£è¯å¸½é€‰æ‹©æ ï¼ˆåªæ˜¾ç¤ºåŠ è½½æˆåŠŸçš„å¸½å­ï¼‰
  async function renderHatList() {
    // æ¸…ç©ºç°æœ‰åˆ—è¡¨
    hatListEl.innerHTML = "";
    
    // ç­‰å¾…å¸½å­é¢„åŠ è½½å®Œæˆ
    await preloadHats();

    // å¦‚æœæ²¡æœ‰å¯ç”¨çš„å¸½å­ï¼Œæ˜¾ç¤ºæç¤º
    if (validHatList.length === 0) {
      hatListEl.innerHTML = `<div style="padding:20px;color:#999;">æ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„åœ£è¯å¸½å›¾ç‰‡ï¼Œè¯·æ£€æŸ¥ hats_images ç›®å½•ä¸‹çš„æ–‡ä»¶</div>`;
      return;
    }

    // åŠ¨æ€ç”Ÿæˆå¸½å­é€‰é¡¹ï¼ˆåªæ¸²æŸ“åŠ è½½æˆåŠŸçš„ï¼‰
    validHatList.forEach((hat, listIndex) => {
      const item = document.createElement("div");
      // å¦‚æœæ˜¯å½“å‰é€‰ä¸­çš„ç´¢å¼•ï¼Œè®¾ç½®active
      const isActive = listIndex === currentHatIndex;
      item.className = `hat-item ${isActive ? 'active' : ''}`;
      item.dataset.listIndex = listIndex; // ç”¨è¿‡æ»¤åçš„ç´¢å¼•
      item.dataset.hatIndex = hat.index; // åŸå§‹å›¾ç‰‡ç´¢å¼•

      // å›¾ç‰‡å…ƒç´ ï¼ˆæ·»åŠ åŠ è½½å¤±è´¥æç¤ºï¼‰
      const imgEl = document.createElement("img");
      imgEl.src = hat.src;
      imgEl.alt = `åœ£è¯å¸½${hat.index+1}`;
      imgEl.onerror = () => {
        item.innerHTML = `<span class="hat-loading">åŠ è½½å¤±è´¥</span>`;
      };

      item.appendChild(imgEl);
      
      // ç‚¹å‡»åˆ‡æ¢å¸½å­
      item.onclick = () => {
        currentHatIndex = listIndex;
        changeHat();
        // æ›´æ–°é€‰ä¸­çŠ¶æ€
        document.querySelectorAll('.hat-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');
      };
      
      hatListEl.appendChild(item);
    });
  }

  // é¡µé¢åŠ è½½å®Œæˆåæ¸²æŸ“å¸½å­åˆ—è¡¨
  window.onload = () => {
    renderHatList();
    // ç»‘å®š"æ¢ä¸€é¡¶"æŒ‰é’®äº‹ä»¶
    changeBtn.onclick = () => {
      if (validHatList.length === 0) return;
      // åˆ‡æ¢åˆ°ä¸‹ä¸€é¡¶ï¼ˆå¾ªç¯åˆ‡æ¢ï¼‰
      currentHatIndex = (currentHatIndex + 1) % validHatList.length;
      // æ›´æ–°å¸½å­é€‰æ‹©æ çš„activeçŠ¶æ€
      document.querySelectorAll('.hat-item').forEach((item, index) => {
        item.classList.toggle('active', index === currentHatIndex);
      });
      // åˆ‡æ¢å¸½å­
      changeHat();
    };
  };

  // é€‰æ‹©å›¾ç‰‡æŒ‰é’®ç»‘å®šï¼ˆç‚¹å‡»å”¤èµ·æ–‡ä»¶é€‰æ‹©ï¼‰
  selectImgBtn.onclick = () => document.getElementById("upload").click();

  // ä¸Šä¼ å¤´åƒå¤„ç†
  function viewer() {
    const file = document.getElementById("upload").files[0];
    if (!file) return;
    
    // éªŒè¯æ–‡ä»¶ç±»å‹
    const fileType = file.type.split('/')[0];
    if (fileType !== 'image') {
      alert("è¯·ä¸Šä¼ å›¾ç‰‡æ ¼å¼çš„æ–‡ä»¶ï¼");
      return;
    }
    
    const reader = new FileReader();
    reader.readAsDataURL(file);
    reader.onload = (e) => {
      avatarImg.src = e.target.result;
      avatarImg.onload = () => {
        initCanvas(); // åˆå§‹åŒ–ç”»å¸ƒ
      };
    };
  }

  // åˆå§‹åŒ–Fabricç”»å¸ƒ
  function initCanvas() {
    // æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨å¸½å­
    if (validHatList.length === 0) {
      alert("æ²¡æœ‰å¯ç”¨çš„åœ£è¯å¸½å›¾ç‰‡ï¼Œè¯·æ£€æŸ¥ hats_images ç›®å½•ä¸‹çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼");
      return;
    }

    // è®¾ç½®ç”»å¸ƒå¤§å°
    cvs.width = screenWidth;
    cvs.height = screenWidth;
    canvasWrap.style.display = "block";

    // åˆå§‹åŒ–Fabricç”»å¸ƒï¼ˆå¸¦èƒŒæ™¯å›¾ï¼‰
    canvasFabric = new fabric.Canvas("cvs", {
      width: screenWidth,
      height: screenWidth,
      backgroundImage: new fabric.Image(avatarImg, {
        scaleX: screenWidth / avatarImg.width,
        scaleY: screenWidth / avatarImg.height,
        originX: 'center',
        originY: 'center',
        left: screenWidth / 2,
        top: screenWidth / 2
      }),
      selection: false // ç¦ç”¨ç”»å¸ƒæ•´ä½“é€‰æ‹©
    });

    // æ˜¾ç¤ºæ“ä½œæŒ‰é’®
    changeBtn.style.display = "inline-block";
    exportBtn.style.display = "inline-block";

    // åŠ è½½é»˜è®¤å¸½å­
    changeHat();
  }

  // åˆ‡æ¢/æ›´æ–°å¸½å­ï¼ˆä½¿ç”¨åŠ è½½æˆåŠŸçš„å¸½å­åˆ—è¡¨ï¼‰
  function changeHat() {
    // ç§»é™¤æ—§å¸½å­å®ä¾‹
    if (hatInstance) {
      canvasFabric.remove(hatInstance);
      hatInstance = null;
    }

    // è·å–å½“å‰é€‰ä¸­çš„æœ‰æ•ˆå¸½å­
    const currentHat = validHatList[currentHatIndex];
    if (!currentHat) return;

    // åˆ›å»ºæ–°çš„å›¾ç‰‡å¯¹è±¡ï¼ˆç¡®ä¿é‡æ–°åŠ è½½å›¾ç‰‡ï¼‰
    const hatImg = new Image();
    hatImg.src = currentHat.src;

    // å›¾ç‰‡åŠ è½½å®Œæˆåæ·»åŠ åˆ°ç”»å¸ƒ
    hatImg.onload = () => {
      // åŠ¨æ€è®¡ç®—å¸½å­åˆå§‹ä½ç½®ï¼šåŸºäºå¤´åƒå°ºå¯¸ï¼Œé»˜è®¤æˆ´åœ¨é¡¶éƒ¨å±…ä¸­
      const avatarScale = screenWidth / avatarImg.width; // å¤´åƒç¼©æ”¾æ¯”ä¾‹
      const hatScale = 120 / hatImg.width; // å¸½å­åˆå§‹ç¼©æ”¾æ¯”ä¾‹
      // å¸½å­åˆå§‹top = å¤´åƒé¡¶éƒ¨å¾€ä¸‹10%ï¼ˆé€‚é…ä¸åŒå°ºå¯¸å¤´åƒï¼‰
      const hatInitTop = (avatarImg.height * avatarScale) * 0.1;
      
      // åˆ›å»ºæ–°çš„å¸½å­å®ä¾‹
      hatInstance = new fabric.Image(hatImg, {
        top: hatInitTop, // åŠ¨æ€åˆå§‹ä½ç½®ï¼ˆå¤´åƒé¡¶éƒ¨ï¼‰
        left: screenWidth / 2, // æ°´å¹³å±…ä¸­
        scaleX: hatScale,
        scaleY: hatScale,
        cornerColor: "#ff9900", // æ§åˆ¶æŸ„é¢œè‰²ï¼ˆåœ£è¯è‰²ï¼‰
        cornerStrokeColor: "#fff",
        cornerStyle: "circle", // åœ†å½¢æ§åˆ¶æŸ„
        transparentCorners: false,
        rotatingPointOffset: 35, // æ—‹è½¬æ§åˆ¶ç‚¹åç§»
        hasRotatingPoint: false, // éšè—æ—‹è½¬æ§åˆ¶æŸ„ï¼ˆåªä¿ç•™ç¼©æ”¾å’Œç§»åŠ¨ï¼‰
        borderColor: "#ff9900", // é€‰ä¸­è¾¹æ¡†é¢œè‰²
        borderScaleFactor: 1.2 // è¾¹æ¡†ç¼©æ”¾æ¯”ä¾‹
      });

      // éšè—ä¸éœ€è¦çš„æ§åˆ¶æŸ„ï¼ˆåªä¿ç•™å³ä¸‹å’Œä¸­é—´æ§åˆ¶æŸ„ï¼‰
      hatInstance.setControlVisible({
        bl: false, // å·¦ä¸‹
        tr: false, // å³ä¸Š
        tl: false, // å·¦ä¸Š
        mr: false, // å³ä¸­
        mt: false, // ä¸Šä¸­
        ml: false, // å·¦ä¸­
        mb: false  // ä¸‹ä¸­
      });

      // æ·»åŠ å¸½å­åˆ°ç”»å¸ƒ
      canvasFabric.add(hatInstance);
      // è®¾ç½®å¸½å­ä¸ºå¯é€‰ä¸­çŠ¶æ€
      hatInstance.selectable = true;
      canvasFabric.setActiveObject(hatInstance);
    };

    // å¸½å­åŠ è½½å¤±è´¥å¤„ç†
    hatImg.onerror = () => {
      alert(`åœ£è¯å¸½åŠ è½½å¤±è´¥ï¼š${currentHat.src}`);
      // åˆ‡æ¢åˆ°ä¸‹ä¸€é¡¶å¸½å­
      currentHatIndex = (currentHatIndex + 1) % validHatList.length;
      changeHat();
      // æ›´æ–°é€‰ä¸­çŠ¶æ€
      document.querySelectorAll('.hat-item').forEach((item, index) => {
        item.classList.toggle('active', index === currentHatIndex);
      });
    };
  }

  // å¯¼å‡ºå›¾ç‰‡
  function exportFunc() {
    if (!canvasFabric || !hatInstance) return;

    // éšè—ç”»å¸ƒå’Œæ“ä½œæŒ‰é’®ï¼Œæ˜¾ç¤ºå¯¼å‡ºå›¾ç‰‡
    canvasWrap.style.display = "none";
    changeBtn.style.display = "none";
    exportBtn.style.display = "none";
    
    // å¯¼å‡ºå›¾ç‰‡ï¼ˆé«˜æ¸…æ ¼å¼ï¼‰
    exportImage.style.display = "block";
    exportImage.src = canvasFabric.toDataURL({
      format: 'png',
      quality: 1.0,
      width: screenWidth * 2, // ä¸¤å€åˆ†è¾¨ç‡ï¼Œæ›´æ¸…æ™°
      height: screenWidth * 2
    });

    // æ›´æ–°æç¤ºæ–‡å­—
    document.getElementById("tip").innerHTML = "é•¿æŒ‰å›¾ç‰‡ä¿å­˜åˆ°æ‰‹æœº ğŸ“± | å³é”®å›¾ç‰‡å¦å­˜ä¸ºï¼ˆç”µè„‘ï¼‰";
    document.getElementById("tip").style.display = "block";
    document.getElementById("tip").style.color = "#ffcc66";
  }

  // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è°ƒæ•´ç”»å¸ƒ
  window.onresize = () => {
    if (canvasFabric) {
      const newWidth = Math.min(window.screen.width - 40, 350);
      if (newWidth !== screenWidth) {
        location.reload(); // ç®€å•å¤„ç†ï¼šåˆ·æ–°é¡µé¢é‡æ–°åˆå§‹åŒ–ï¼ˆä¹Ÿå¯ä¼˜åŒ–ä¸ºä¸åˆ·æ–°è°ƒæ•´ï¼‰
      }
    }
  };
</script>
</body>
</html>